<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AeroSocial - Next-Gen Communication Platform</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Authentication Gateway -->
    <div id="gatekeeper">
        <div class="auth-box">
            <div class="logo-container">
                <h1 id="auth-title">AeroSocial</h1>
                <div class="logo-accent"></div>
            </div>
            <p id="auth-subtitle">Secure Identification Required</p>
            
            <div id="signup-fields" style="display: none;">
                <input type="text" id="username-in" class="aero-input" placeholder="Choose Username" maxlength="20">
                <small class="input-hint">3-20 characters, alphanumeric only</small>
            </div>
            
            <input type="email" id="email-in" class="aero-input" placeholder="Email Address" autocomplete="email">
            <input type="password" id="pass-in" class="aero-input" placeholder="Password" autocomplete="current-password">
            
            <div class="auth-actions">
                <button id="main-auth-btn" class="gel-button primary" onclick="handleAuth()">
                    <span class="btn-text">Log In</span>
                    <span class="btn-loader" style="display: none;">‚óè‚óè‚óè</span>
                </button>
            </div>
            
            <div class="auth-footer">
                <p>
                    <span id="auth-toggle-text">New user?</span> 
                    <a href="#" onclick="toggleAuthMode(); return false;" class="auth-link">Create Account</a>
                </p>
                <p class="privacy-notice">By continuing, you agree to our Terms of Service</p>
            </div>
        </div>
    </div>
    
    <!-- Main Application Interface -->
    <div id="app-root">
        <!-- Left Sidebar: Navigation & Contacts -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="brand">
                    <span class="brand-icon">‚ö°</span>
                    <span class="brand-text">AeroSocial</span>
                </div>
                <button class="settings-btn" onclick="openSettings()" title="Settings">‚öô</button>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button id="tab-friends" class="tab-btn active" onclick="setView('dm')">
                    <span class="tab-icon">üë•</span>
                    <span>Friends</span>
                </button>
                <button id="tab-groups" class="tab-btn" onclick="setView('group')">
                    <span class="tab-icon">üåê</span>
                    <span>Groups</span>
                </button>
            </div>
            
            <!-- Search Bar -->
            <div class="search-container">
                <input type="text" id="contact-search" class="search-input" placeholder="Search conversations..." oninput="filterContacts(this.value)">
            </div>
            
            <!-- Contact/Group List -->
            <div id="sidebar-list"></div>
            
            <!-- User Profile Tray -->
            <div class="profile-tray">
                <div class="pfp-container">
                    <img id="my-pfp" src="https://api.dicebear.com/7.x/bottts/svg?seed=default" alt="Profile" onclick="openPfpManager()">
                    <div class="status-indicator online"></div>
                    <input type="file" id="pfp-upload-input" style="display: none;" accept="image/*" onchange="handlePfpUpload(event)">
                </div>
                <div class="user-info">
                    <div id="my-display-name">Loading...</div>
                    <div id="my-full-id">#0000</div>
                </div>
                <button class="mini-logout" title="Logout" onclick="logout()">‚úï</button>
            </div>
        </div>
        
        <!-- Main Chat Area -->
        <div class="chat-area">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-header-info">
                    <h2 id="chat-title">Global Hub</h2>
                    <p id="chat-subtitle">Public community space</p>
                </div>
                <div class="chat-header-actions">
                    <button class="icon-btn" onclick="toggleChatInfo()" title="Chat Info">‚Ñπ</button>
                    <button class="icon-btn" onclick="toggleSearch()" title="Search Messages">üîç</button>
                </div>
            </div>
            
            <!-- Messages Container -->
            <div id="chat-messages"></div>
            
            <!-- Typing Indicator -->
            <div id="typing-indicator" style="display: none;">
                <span class="typing-dots">Someone is typing...</span>
            </div>
            
            <!-- Message Input Footer -->
            <div class="chat-footer">
                <button class="attach-btn" onclick="attachFile()" title="Attach File">üìé</button>
                <input type="text" id="chat-in" class="aero-input message-input" placeholder="Type a message..." 
                       onkeydown="handleMessageInput(event)" 
                       oninput="handleTyping()">
                <button onclick="sendMessage()" class="gel-button send-btn" title="Send Message">
                    <span>Send</span>
                    <span class="send-icon">‚û§</span>
                </button>
            </div>
        </div>
        
        <!-- Right Sidebar: Chat Info (Hidden by default) -->
        <div id="chat-info-panel" class="info-panel" style="display: none;">
            <div class="info-header">
                <h3>Chat Information</h3>
                <button onclick="toggleChatInfo()">‚úï</button>
            </div>
            <div class="info-content">
                <p>Additional chat details will appear here</p>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button onclick="closeSettings()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Appearance</h3>
                    <label>
                        <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()"> Dark Mode
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Notifications</h3>
                    <label>
                        <input type="checkbox" id="sound-toggle" checked onchange="toggleSounds()"> Sound Effects
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Privacy</h3>
                    <label>
                        <input type="checkbox" id="read-receipts" checked> Read Receipts
                    </label>
                </div>
            </div>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>
